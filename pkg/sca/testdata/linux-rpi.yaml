package:
  name: linux-rpi
  version: "1.20250915"
  epoch: 0
  description: "rpi device trees and prebuilt kernels"
  copyright:
    - license: GPL-2.0

environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - busybox
      - git

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/raspberrypi/firmware
      tag: ${{package.version}}
      expected-commit: 676efed1194de38975889a34276091da1f5aadd3

  - runs: |
      install -Dm0755 -t ${{targets.destdir}}/boot boot/kernel*.img

subpackages:
  - name: linux-rpi-modules
    description: "Linux raspberry pi kernel modules"
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib/modules
          # xz decompression is slow, don't install all of these it will just make
          # unit tests take an extra 2 minutes.
          for moddir in modules/*; do
            mod=$(find "$moddir" -name '*.ko.*' -print -quit)
            install -Dm0755 "$mod" ${{targets.subpkgdir}}/usr/lib/"$mod"
          done

